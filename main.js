/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => TargetWordCountPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian = require("obsidian");
var SetTargetWordCountModal = class extends import_obsidian.Modal {
  constructor(app, plugin) {
    super(app);
    this.plugin = plugin;
    this.pluginActive = false;
  }
  onOpen() {
    let { contentEl } = this;
    let targetWordCountInput;
    contentEl.createEl("h2", { text: "Set Target Word Count" });
    new import_obsidian.Setting(contentEl).setName("Target Word Count").addText((text) => {
      text.setPlaceholder("Enter target word count...");
      targetWordCountInput = text.inputEl;
    });
    new import_obsidian.Setting(contentEl).addButton((btn) => {
      btn.setButtonText("Set").onClick(() => {
        const value = parseInt(targetWordCountInput.value);
        if (!isNaN(value) && value > 0) {
          this.plugin.setTargetWordCount(value);
          new import_obsidian.Notice(`Target word count set to ${value}`);
          this.close();
        } else {
          new import_obsidian.Notice("Please enter a valid number.");
        }
      });
    });
    targetWordCountInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        const value = parseInt(targetWordCountInput.value);
        if (!isNaN(value) && value > 0) {
          this.plugin.setTargetWordCount(value);
          new import_obsidian.Notice(`Target word count set to ${value}`);
          this.close();
        } else {
          new import_obsidian.Notice("Please enter a valid number.");
        }
      }
    });
  }
  onClose() {
    let { contentEl } = this;
    contentEl.empty();
  }
};
var TargetWordCountPlugin = class extends import_obsidian.Plugin {
  constructor() {
    super(...arguments);
    this.lastValidContent = "";
    this.currentWordCount = 0;
    this.targetWordCount = 0;
    this.targetReachedOnce = false;
    this.prevNewWords = 0;
    this.baselineWordCount = 0;
  }
  onload() {
    this.addCommand({
      id: "enable-target-word-count",
      name: "Set New",
      callback: () => {
        new SetTargetWordCountModal(this.app, this).open();
      }
    });
    this.addCommand({
      id: "reset-target-word-count-progress",
      name: "Reset",
      callback: () => {
        this.resetProgress();
      }
    });
    this.addCommand({
      id: "disable-target-word-count",
      name: "Stop",
      callback: () => {
        this.disablePlugin();
      }
    });
    this.statusBarItem = this.addStatusBarItem();
    this.updateStatusBar();
    this.registerEvent(this.app.workspace.on("editor-change", this.handleEditorChange.bind(this)));
    this.registerEvent(this.app.workspace.on("active-leaf-change", this.handleActiveLeafChange.bind(this)));
  }
  setTargetWordCount(num) {
    this.targetWordCount = num;
    if (!this.pluginActive) {
      this.registerEventListeners();
    }
    this.resetProgress();
  }
  disablePlugin() {
    this.app.workspace.off("editor-change", this.handleEditorChange.bind(this));
    this.app.workspace.off("active-leaf-change", this.handleActiveLeafChange.bind(this));
    this.pluginActive = false;
    this.targetWordCount = 0;
    this.updateStatusBar();
  }
  registerEventListeners() {
    this.registerEvent(this.app.workspace.on("editor-change", this.handleEditorChange.bind(this)));
    this.registerEvent(this.app.workspace.on("active-leaf-change", this.handleActiveLeafChange.bind(this)));
    this.pluginActive = true;
  }
  resetProgress() {
    this.targetReachedOnce = false;
    const editor = this.getCurrentEditor();
    if (editor) {
      this.lastValidContent = editor.getValue();
      const baselineWordCount = this.getWordCount(this.lastValidContent);
      this.currentWordCount = 0;
      this.baselineWordCount = baselineWordCount;
    }
    this.updateStatusBar();
  }
  handleEditorChange(instance, change) {
    const editor = this.getCurrentEditor();
    if (editor) {
      const content = editor.getValue();
      const currentCharCount = content.length;
      const totalWordCount = this.getWordCount(content);
      const newWordCount = totalWordCount - this.baselineWordCount + this.prevNewWords;
      if (currentCharCount < this.lastValidContent.length && !this.targetReachedOnce && this.pluginActive) {
        editor.setValue(this.lastValidContent);
        new import_obsidian.Notice("Target Word Count Plugin: Cannot delete characters until the target word count is reached. Use command Target Word Count: Stop to re-enable editing.");
      } else {
        this.lastValidContent = content;
        if (newWordCount >= 0) {
          this.currentWordCount = newWordCount;
        }
        if (this.currentWordCount >= this.targetWordCount && !this.targetReachedOnce) {
          this.targetReachedOnce = true;
        }
        this.updateStatusBar();
      }
    }
  }
  handleActiveLeafChange() {
    const editor = this.getCurrentEditor();
    if (editor) {
      const currentContent = editor.getValue();
      this.prevNewWords = this.currentWordCount;
      this.baselineWordCount = this.getWordCount(currentContent);
      this.lastValidContent = currentContent;
      this.updateStatusBar();
    }
  }
  getCurrentEditor() {
    const activeView = this.app.workspace.getActiveViewOfType(import_obsidian.MarkdownView);
    return activeView ? activeView.editor : null;
  }
  getWordCount(text) {
    return text.split(/\s+/).filter(Boolean).length;
  }
  updateStatusBar() {
    if (this.targetWordCount === 0) {
      this.statusBarItem.setText("");
    } else if (this.targetReachedOnce) {
      this.statusBarItem.setText(`Target reached. Edit freely.`);
    } else {
      this.statusBarItem.setText(`New Words: ${this.currentWordCount}/${this.targetWordCount}`);
    }
  }
  onunload() {
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgUGx1Z2luLCBNb2RhbCwgU2V0dGluZywgQXBwLCBOb3RpY2UsIE1hcmtkb3duVmlldywgRWRpdG9yIH0gZnJvbSAnb2JzaWRpYW4nO1xuXG5cbmludGVyZmFjZSBQbHVnaW5TdGF0ZSB7XG4gICAgbGFzdFZhbGlkQ29udGVudDogc3RyaW5nO1xuICAgIGN1cnJlbnRXb3JkQ291bnQ6IG51bWJlcjtcbiAgICB0YXJnZXRXb3JkQ291bnQ6IG51bWJlcjtcbiAgICB0YXJnZXRSZWFjaGVkT25jZTogYm9vbGVhbjtcbiAgICBwcmV2TmV3V29yZHM6IG51bWJlcjtcbiAgICBiYXNlbGluZVdvcmRDb3VudDogbnVtYmVyO1xuICAgIHBsdWdpbkFjdGl2ZTogYm9vbGVhbjtcbn1cblxuXG5jbGFzcyBTZXRUYXJnZXRXb3JkQ291bnRNb2RhbCBleHRlbmRzIE1vZGFsIHtcbiAgICBwbHVnaW46IFRhcmdldFdvcmRDb3VudFBsdWdpbjtcblxuICAgIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwbHVnaW46IFRhcmdldFdvcmRDb3VudFBsdWdpbikge1xuICAgICAgICBzdXBlcihhcHApO1xuICAgICAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICAgICAgdGhpcy5wbHVnaW5BY3RpdmUgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBvbk9wZW4oKSB7XG4gICAgICAgIGxldCB7Y29udGVudEVsfSA9IHRoaXM7XG4gICAgICAgIGxldCB0YXJnZXRXb3JkQ291bnRJbnB1dDogSFRNTElucHV0RWxlbWVudDtcblxuICAgICAgICBjb250ZW50RWwuY3JlYXRlRWwoJ2gyJywge3RleHQ6ICdTZXQgVGFyZ2V0IFdvcmQgQ291bnQnfSk7XG5cbiAgICAgICAgbmV3IFNldHRpbmcoY29udGVudEVsKVxuICAgICAgICAgICAgLnNldE5hbWUoJ1RhcmdldCBXb3JkIENvdW50JylcbiAgICAgICAgICAgIC5hZGRUZXh0KHRleHQgPT4ge1xuICAgICAgICAgICAgICAgIHRleHQuc2V0UGxhY2Vob2xkZXIoJ0VudGVyIHRhcmdldCB3b3JkIGNvdW50Li4uJylcbiAgICAgICAgICAgICAgICB0YXJnZXRXb3JkQ291bnRJbnB1dCA9IHRleHQuaW5wdXRFbDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRlbnRFbClcbiAgICAgICAgICAgIC5hZGRCdXR0b24oYnRuID0+IHtcbiAgICAgICAgICAgICAgICBidG4uc2V0QnV0dG9uVGV4dCgnU2V0JylcbiAgICAgICAgICAgICAgICAgICAgLm9uQ2xpY2soKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBwYXJzZUludCh0YXJnZXRXb3JkQ291bnRJbnB1dC52YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzTmFOKHZhbHVlKSAmJiB2YWx1ZSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXRUYXJnZXRXb3JkQ291bnQodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoYFRhcmdldCB3b3JkIGNvdW50IHNldCB0byAke3ZhbHVlfWApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE5vdGljZSgnUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyLicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIHRhcmdldFdvcmRDb3VudElucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXByZXNzJywgKGUpID0+IHtcbiAgICAgICAgICAgIGlmIChlLmtleSA9PT0gJ0VudGVyJykge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHBhcnNlSW50KHRhcmdldFdvcmRDb3VudElucHV0LnZhbHVlKTtcbiAgICAgICAgICAgICAgICBpZiAoIWlzTmFOKHZhbHVlKSAmJiB2YWx1ZSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0VGFyZ2V0V29yZENvdW50KHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgbmV3IE5vdGljZShgVGFyZ2V0IHdvcmQgY291bnQgc2V0IHRvICR7dmFsdWV9YCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBuZXcgTm90aWNlKCdQbGVhc2UgZW50ZXIgYSB2YWxpZCBudW1iZXIuJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBvbkNsb3NlKCkge1xuICAgICAgICBsZXQge2NvbnRlbnRFbH0gPSB0aGlzO1xuICAgICAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFRhcmdldFdvcmRDb3VudFBsdWdpbiBleHRlbmRzIFBsdWdpbiB7XG4gICAgbGFzdFZhbGlkQ29udGVudCA9IFwiXCI7XG4gICAgY3VycmVudFdvcmRDb3VudCA9IDA7XG4gICAgdGFyZ2V0V29yZENvdW50ID0gMDtcbiAgICB0YXJnZXRSZWFjaGVkT25jZSA9IGZhbHNlO1xuICAgIHByZXZOZXdXb3JkcyA9IDA7XG4gICAgYmFzZWxpbmVXb3JkQ291bnQgPSAwO1xuICAgIHN0YXR1c0Jhckl0ZW06IEhUTUxFbGVtZW50O1xuXG4gICAgb25sb2FkKCkge1xuICAgICAgICB0aGlzLmFkZENvbW1hbmQoe1xuICAgICAgICAgICAgaWQ6ICdlbmFibGUtdGFyZ2V0LXdvcmQtY291bnQnLFxuICAgICAgICAgICAgbmFtZTogJ1NldCBOZXcnLFxuICAgICAgICAgICAgY2FsbGJhY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBuZXcgU2V0VGFyZ2V0V29yZENvdW50TW9kYWwodGhpcy5hcHAsIHRoaXMpLm9wZW4oKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuYWRkQ29tbWFuZCh7XG4gICAgICAgICAgICBpZDogJ3Jlc2V0LXRhcmdldC13b3JkLWNvdW50LXByb2dyZXNzJyxcbiAgICAgICAgICAgIG5hbWU6ICdSZXNldCcsXG4gICAgICAgICAgICBjYWxsYmFjazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMucmVzZXRQcm9ncmVzcygpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5hZGRDb21tYW5kKHtcbiAgICAgICAgICAgIGlkOiAnZGlzYWJsZS10YXJnZXQtd29yZC1jb3VudCcsXG4gICAgICAgICAgICBuYW1lOiAnU3RvcCcsXG4gICAgICAgICAgICBjYWxsYmFjazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZVBsdWdpbigpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5zdGF0dXNCYXJJdGVtID0gdGhpcy5hZGRTdGF0dXNCYXJJdGVtKCk7XG4gICAgICAgIHRoaXMudXBkYXRlU3RhdHVzQmFyKCk7XG5cbiAgICAgICAgdGhpcy5yZWdpc3RlckV2ZW50KHRoaXMuYXBwLndvcmtzcGFjZS5vbignZWRpdG9yLWNoYW5nZScsIHRoaXMuaGFuZGxlRWRpdG9yQ2hhbmdlLmJpbmQodGhpcykpKTtcbiAgICAgICAgdGhpcy5yZWdpc3RlckV2ZW50KHRoaXMuYXBwLndvcmtzcGFjZS5vbihcImFjdGl2ZS1sZWFmLWNoYW5nZVwiLCB0aGlzLmhhbmRsZUFjdGl2ZUxlYWZDaGFuZ2UuYmluZCh0aGlzKSkpO1xuICAgIH1cblxuICAgIHNldFRhcmdldFdvcmRDb3VudChudW06IG51bWJlcikge1xuICAgICAgICB0aGlzLnRhcmdldFdvcmRDb3VudCA9IG51bTtcbiAgICAgICAgLy8gQWN0aXZhdGUgdGhlIHBsdWdpbiBieSByZWdpc3RlcmluZyBldmVudCBsaXN0ZW5lcnMgaWYgbm90IGFscmVhZHkgYWN0aXZlXG4gICAgICAgIGlmICghdGhpcy5wbHVnaW5BY3RpdmUpIHtcbiAgICAgICAgICAgIHRoaXMucmVnaXN0ZXJFdmVudExpc3RlbmVycygpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucmVzZXRQcm9ncmVzcygpO1xuICAgIH1cblxuICAgIGRpc2FibGVQbHVnaW4oKSB7XG4gICAgICAgIC8vIFJlbW92ZSBldmVudCBsaXN0ZW5lcnMgdG8gbWFrZSB0aGUgcGx1Z2luIGRvcm1hbnRcbiAgICAgICAgdGhpcy5hcHAud29ya3NwYWNlLm9mZignZWRpdG9yLWNoYW5nZScsIHRoaXMuaGFuZGxlRWRpdG9yQ2hhbmdlLmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLmFwcC53b3Jrc3BhY2Uub2ZmKCdhY3RpdmUtbGVhZi1jaGFuZ2UnLCB0aGlzLmhhbmRsZUFjdGl2ZUxlYWZDaGFuZ2UuYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMucGx1Z2luQWN0aXZlID0gZmFsc2U7XG4gICAgICAgIHRoaXMudGFyZ2V0V29yZENvdW50ID0gMDsgLy8gT3B0aW9uYWw6IFJlc2V0IHRhcmdldCB3b3JkIGNvdW50IG9uIGRpc2FibGVcbiAgICAgICAgdGhpcy51cGRhdGVTdGF0dXNCYXIoKTtcbiAgICB9XG4gICAgXG4gICAgcmVnaXN0ZXJFdmVudExpc3RlbmVycygpIHtcbiAgICAgICAgdGhpcy5yZWdpc3RlckV2ZW50KHRoaXMuYXBwLndvcmtzcGFjZS5vbignZWRpdG9yLWNoYW5nZScsIHRoaXMuaGFuZGxlRWRpdG9yQ2hhbmdlLmJpbmQodGhpcykpKTtcbiAgICAgICAgdGhpcy5yZWdpc3RlckV2ZW50KHRoaXMuYXBwLndvcmtzcGFjZS5vbignYWN0aXZlLWxlYWYtY2hhbmdlJywgdGhpcy5oYW5kbGVBY3RpdmVMZWFmQ2hhbmdlLmJpbmQodGhpcykpKTtcbiAgICAgICAgdGhpcy5wbHVnaW5BY3RpdmUgPSB0cnVlO1xuICAgIH1cblxuICAgIHJlc2V0UHJvZ3Jlc3MoKSB7XG4gICAgICAgIHRoaXMudGFyZ2V0UmVhY2hlZE9uY2UgPSBmYWxzZTtcbiAgICAgICAgY29uc3QgZWRpdG9yID0gdGhpcy5nZXRDdXJyZW50RWRpdG9yKCk7XG4gICAgICAgIGlmIChlZGl0b3IpIHtcbiAgICAgICAgICAgIHRoaXMubGFzdFZhbGlkQ29udGVudCA9IGVkaXRvci5nZXRWYWx1ZSgpO1xuICAgICAgICAgICAgLy8gU2V0IGJhc2VsaW5lIHdvcmQgY291bnQgd2hlbiB0aGUgdGFyZ2V0IG1vZGUgaXMgYWN0aXZhdGVkIG9yIHJlc2V0XG4gICAgICAgICAgICBjb25zdCBiYXNlbGluZVdvcmRDb3VudCA9IHRoaXMuZ2V0V29yZENvdW50KHRoaXMubGFzdFZhbGlkQ29udGVudCk7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRXb3JkQ291bnQgPSAwOyAvLyBSZXNldCBjdXJyZW50IG5ldyB3b3JkIGNvdW50XG4gICAgICAgICAgICAvLyBTdG9yZSB0aGUgYmFzZWxpbmUgd29yZCBjb3VudCBmb3IgY29tcGFyaXNvblxuICAgICAgICAgICAgdGhpcy5iYXNlbGluZVdvcmRDb3VudCA9IGJhc2VsaW5lV29yZENvdW50O1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudXBkYXRlU3RhdHVzQmFyKCk7XG4gICAgfVxuXG4gICAgaGFuZGxlRWRpdG9yQ2hhbmdlKGluc3RhbmNlLCBjaGFuZ2UpIHtcbiAgICAgICAgY29uc3QgZWRpdG9yID0gdGhpcy5nZXRDdXJyZW50RWRpdG9yKCk7XG4gICAgICAgIGlmIChlZGl0b3IpIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBlZGl0b3IuZ2V0VmFsdWUoKTtcbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRDaGFyQ291bnQgPSBjb250ZW50Lmxlbmd0aDtcbiAgICAgICAgICAgIGNvbnN0IHRvdGFsV29yZENvdW50ID0gdGhpcy5nZXRXb3JkQ291bnQoY29udGVudCk7XG4gICAgICAgICAgICBjb25zdCBuZXdXb3JkQ291bnQgPSB0b3RhbFdvcmRDb3VudCAtIHRoaXMuYmFzZWxpbmVXb3JkQ291bnQgKyB0aGlzLnByZXZOZXdXb3JkczsgLy8gQ2FsY3VsYXRlIG5ldyB3b3JkcyBhZGRlZFxuICAgIFxuICAgICAgICAgICAgLy8gVXNlIGNoYXJhY3RlciBjb3VudCB0byBkZXRlcm1pbmUgaWYgd2Ugc2hvdWxkIHJldmVydCBjaGFuZ2VzXG4gICAgICAgICAgICBpZiAoY3VycmVudENoYXJDb3VudCA8IHRoaXMubGFzdFZhbGlkQ29udGVudC5sZW5ndGggJiYgIXRoaXMudGFyZ2V0UmVhY2hlZE9uY2UgJiYgdGhpcy5wbHVnaW5BY3RpdmUpIHtcbiAgICAgICAgICAgICAgICBlZGl0b3Iuc2V0VmFsdWUodGhpcy5sYXN0VmFsaWRDb250ZW50KTtcbiAgICAgICAgICAgICAgICBuZXcgTm90aWNlKCdUYXJnZXQgV29yZCBDb3VudCBQbHVnaW46IENhbm5vdCBkZWxldGUgY2hhcmFjdGVycyB1bnRpbCB0aGUgdGFyZ2V0IHdvcmQgY291bnQgaXMgcmVhY2hlZC4gVXNlIGNvbW1hbmQgVGFyZ2V0IFdvcmQgQ291bnQ6IFN0b3AgdG8gcmUtZW5hYmxlIGVkaXRpbmcuJyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMubGFzdFZhbGlkQ29udGVudCA9IGNvbnRlbnQ7XG4gICAgICAgICAgICAgICAgLy8gVXBkYXRlIG9ubHkgaWYgbmV3IHdvcmRzIGhhdmUgYmVlbiBhZGRlZFxuICAgICAgICAgICAgICAgIGlmIChuZXdXb3JkQ291bnQgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRXb3JkQ291bnQgPSBuZXdXb3JkQ291bnQ7XG4gICAgICAgICAgICAgICAgfVxuICAgIFxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRXb3JkQ291bnQgPj0gdGhpcy50YXJnZXRXb3JkQ291bnQgJiYgIXRoaXMudGFyZ2V0UmVhY2hlZE9uY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50YXJnZXRSZWFjaGVkT25jZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdHVzQmFyKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBoYW5kbGVBY3RpdmVMZWFmQ2hhbmdlKCkge1xuICAgICAgICAvLyBPYnRhaW4gdGhlIGN1cnJlbnQgZWRpdG9yIGZvciB0aGUgbmV3bHkgZm9jdXNlZCBkb2N1bWVudFxuICAgICAgICBjb25zdCBlZGl0b3IgPSB0aGlzLmdldEN1cnJlbnRFZGl0b3IoKTtcbiAgICAgICAgaWYgKGVkaXRvcikge1xuICAgICAgICAgICAgY29uc3QgY3VycmVudENvbnRlbnQgPSBlZGl0b3IuZ2V0VmFsdWUoKTtcbiAgICAgICAgICAgIHRoaXMucHJldk5ld1dvcmRzID0gdGhpcy5jdXJyZW50V29yZENvdW50O1xuICAgICAgICAgICAgdGhpcy5iYXNlbGluZVdvcmRDb3VudCA9IHRoaXMuZ2V0V29yZENvdW50KGN1cnJlbnRDb250ZW50KTtcbiAgICAgICAgICAgIHRoaXMubGFzdFZhbGlkQ29udGVudCA9IGN1cnJlbnRDb250ZW50O1xuICAgICAgICAgICAgdGhpcy51cGRhdGVTdGF0dXNCYXIoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBcbiAgICBcbiAgICBcblxuICAgIGdldEN1cnJlbnRFZGl0b3IoKSB7XG4gICAgICAgIGNvbnN0IGFjdGl2ZVZpZXcgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlVmlld09mVHlwZShNYXJrZG93blZpZXcpO1xuICAgICAgICByZXR1cm4gYWN0aXZlVmlldyA/IGFjdGl2ZVZpZXcuZWRpdG9yIDogbnVsbDtcbiAgICB9XG5cbiAgICBnZXRXb3JkQ291bnQodGV4dCkge1xuICAgICAgICByZXR1cm4gdGV4dC5zcGxpdCgvXFxzKy8pLmZpbHRlcihCb29sZWFuKS5sZW5ndGg7XG4gICAgfVxuXG4gICAgdXBkYXRlU3RhdHVzQmFyKCkge1xuICAgICAgICBpZiAodGhpcy50YXJnZXRXb3JkQ291bnQgPT09IDApIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzQmFySXRlbS5zZXRUZXh0KCcnKTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnRhcmdldFJlYWNoZWRPbmNlKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXR1c0Jhckl0ZW0uc2V0VGV4dChgVGFyZ2V0IHJlYWNoZWQuIEVkaXQgZnJlZWx5LmApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zdGF0dXNCYXJJdGVtLnNldFRleHQoYE5ldyBXb3JkczogJHt0aGlzLmN1cnJlbnRXb3JkQ291bnR9LyR7dGhpcy50YXJnZXRXb3JkQ291bnR9YCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvbnVubG9hZCgpIHtcbiAgICB9XG59XG4iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsc0JBQTBFO0FBYzFFLElBQU0sMEJBQU4sY0FBc0Msc0JBQU07QUFBQSxFQUd4QyxZQUFZLEtBQVUsUUFBK0I7QUFDakQsVUFBTSxHQUFHO0FBQ1QsU0FBSyxTQUFTO0FBQ2QsU0FBSyxlQUFlO0FBQUEsRUFDeEI7QUFBQSxFQUVBLFNBQVM7QUFDTCxRQUFJLEVBQUMsVUFBUyxJQUFJO0FBQ2xCLFFBQUk7QUFFSixjQUFVLFNBQVMsTUFBTSxFQUFDLE1BQU0sd0JBQXVCLENBQUM7QUFFeEQsUUFBSSx3QkFBUSxTQUFTLEVBQ2hCLFFBQVEsbUJBQW1CLEVBQzNCLFFBQVEsVUFBUTtBQUNiLFdBQUssZUFBZSw0QkFBNEI7QUFD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
